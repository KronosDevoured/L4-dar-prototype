<!DOCTYPE html>
<html lang="en">
    <script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.164.0/build/three.module.js"
  }
}
</script>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>L4 Aerial Car Control Tool</title>
<link rel="icon" type="image/svg+xml" href="favicon.svg" />
<style>
  /* === CSS BASE START === */
  html,body{margin:0;padding:0;height:100%;background:#ffffff;color:#0e0f12;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overscroll-behavior:none}
  body{background:linear-gradient(180deg,#f6f7fb 0%,#eef1f6 45%,#e9edf3 100%);}
  *, *::before, *::after{box-sizing:border-box}
  *{-webkit-user-select:none;-ms-user-select:none;user-select:none;-webkit-touch-callout:none}
  #gl{position:fixed;inset:0;z-index:0;display:block}
  #hud{position:fixed;inset:0;z-index:1;display:block;touch-action:none}
  /* === CSS BASE END === */

  /* === HAMBURGER === */
  #menuBtn{
    position:fixed;top:.6rem;right:.6rem;z-index:3;width:44px;height:44px;
    border-radius:12px;border:1px solid #3a3d45;background:#181a20;display:grid;place-items:center;
    box-shadow:0 2px 10px rgba(0,0,0,.25)
  }
  #menuBtn .bar{display:block;width:20px;height:2px;background:#e8e8ea;margin:3px 0}
  #menuBtn.active{background:#0066ff;border-color:#4c8dff}

  /* === THEME BUTTON (Sun/Moon) === */
  #themeBtn{
    position:fixed;top:.6rem;right:3.5rem;z-index:3;width:44px;height:44px;
    border:none;background:transparent;font-size:1.8rem;cursor:pointer;
    display:grid;place-items:center;padding:0;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,.3));
  }
  #themeBtn:hover{transform:scale(1.1)}
  #themeBtn:active{transform:scale(0.95)}

  /* Fullscreen button */
  #fullscreenBtn{
    position:fixed;top:.6rem;right:7rem;z-index:3;width:44px;height:44px;
    border:2px solid #4c8dff;background:rgba(76,141,255,0.15);
    font-size:2rem;cursor:pointer;border-radius:8px;
    display:grid;place-items:center;padding:0;
    filter: drop-shadow(0 2px 8px rgba(76,141,255,.4));
    color:#4c8dff;
  }
  #fullscreenBtn:hover{transform:scale(1.1);background:rgba(76,141,255,0.25);}
  #fullscreenBtn:active{transform:scale(0.95)}

  /* === OVERLAY MENU PANEL === */
  #menuOverlay{
    position:fixed; inset:0; z-index:4; display:none;
    background:rgba(10,12,16,0.45); -webkit-backdrop-filter: blur(3px); backdrop-filter: blur(3px);
    overflow-x:hidden;
  }
  #menuPanel{
    position:absolute; left:50%; top:12vh; transform:translateX(-50%);
    width:min(960px, calc(100vw - 2rem)); max-height:76vh; overflow:auto;
    background:rgba(24,26,32,.96); color:#e8e8ea; border:1px solid #3a3d45; border-radius:14px;
    box-shadow:0 20px 60px rgba(0,0,0,.35);
    overflow-x:hidden;
  }
  .mp-header{
    position:sticky; top:0; background:rgba(24,26,32,.98); z-index:1;
    padding:.9rem clamp(.8rem, 2vw, 1rem); border-bottom:1px solid #33373f; display:flex; align-items:center; justify-content:space-between;
  }
  .mp-title{font-weight:700;letter-spacing:.2px}
  .mp-close{border:1px solid #3a3d45;background:#181a20;color:#e8e8ea;border-radius:10px;padding:.35rem .6rem;font-weight:600}
  .mp-body{
    padding:clamp(.6rem,2vw,1rem);
    display:grid; grid-template-columns: 1fr; gap:14px;
  }

  .card{
    background:#15171d; border:1px solid #33373f; border-radius:12px; padding:.9rem;
  }
  .card h3{
    margin:.1rem 0 .7rem; font-size:1rem; opacity:.95; cursor:pointer; user-select:none;
    display:flex; align-items:center; justify-content:space-between;
  }
  .card h3:hover{opacity:1; color:#4c8dff;}
  .card h3::after{
    content:'â–¼'; font-size:.8rem; transition: transform 0.2s;
  }
  .card.collapsed h3::after{
    transform: rotate(-90deg);
  }
  .card-content{
    overflow:hidden; transition: max-height 0.3s ease, opacity 0.2s ease;
  }
  .card.collapsed .card-content{
    max-height:0 !important; opacity:0;
  }
  .row{display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; margin:.45rem 0; width:100%;}
  .tip{
    font-size:.86rem; opacity:.85; line-height:1.5; margin:.5rem 0;
    padding:.5rem .7rem; background:rgba(255,255,255,.03);
    border-left:3px solid #4c8dff; border-radius:4px;
  }
  .btn{border:1px solid #3a3d45;padding:.45rem .7rem;border-radius:999px;background:#181a20;color:#e8e8ea;font-weight:600;letter-spacing:.2px;cursor:pointer}
  .btn.active{background:#0066ff;border-color:#4c8dff}
  .tag{
    background:#181a20;border:1px solid #3a3d45;padding:.25rem .5rem;
    border-radius:999px;font-size:.82rem;white-space:nowrap;
    cursor:text;user-select:text;
  }
  .tag:hover{border-color:#4c8dff}
  .tag:focus{outline:2px solid #4c8dff;background:#1f2229}

  .sl{
    display:flex; align-items:center; gap:.6rem; flex-wrap:nowrap;
    width:100%; min-width:0;
  }
  .sl label{
    font-size:.88rem; opacity:.92; flex:0 0 150px; min-width:120px; max-width:220px;
  }
  .sl input[type=range]{
    accent-color:#4c8dff;
    flex:1 1 auto; min-width:0; max-width:100%; width:100%;
  }
  .sl .tag{flex:0 0 auto}

  @media (max-width:520px){
    .sl{flex-wrap:wrap}
    .sl label{flex:1 0 100%}
    .sl input[type=range]{flex:1 0 100%}
    .sl .tag{margin-left:auto}
  }

  select{background:#181a20;color:#e8e8ea;border:1px solid #3a3d45;border-radius:10px;padding:.35rem .5rem;max-width:100%}

  /* Hints (stick/DAR) */
  #joyHint,#darHint{position:fixed; z-index:2; pointer-events:none;background:rgba(24,26,32,.92); border:1px solid #3a3d45; color:#cfd3dc;
    padding:.35rem .55rem; border-radius:10px; font-size:.85rem; white-space:nowrap; transform:translate(-50%,-50%); opacity:0; transition:opacity .25s ease;}
  #joyHint.show,#darHint.show{opacity:1;}

  /* XYZ gizmo frame */
  #gizmoFrame{
    position:fixed; right:.6rem; top:64px; width:84px; height:84px; z-index:2;
    border-radius:10px; border:1px solid #3a3d45; background:rgba(24,26,32,.5);
    box-shadow:0 8px 24px rgba(0,0,0,.2); pointer-events:none;
  }
</style>
</head>
<body>
  <!-- CANVASES -->
  <canvas id="gl"></canvas>
  <canvas id="hud"></canvas>
  <div id="gizmoFrame"></div>

  <!-- HAMBURGER -->
  <button id="menuBtn" type="button" title="Open Menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></button>

  <!-- FULLSCREEN TOGGLE -->
  <button id="fullscreenBtn" type="button" title="Toggle Fullscreen">â›¶</button>

  <!-- THEME TOGGLE (Sun/Moon) -->
  <button id="themeBtn" type="button" title="Toggle Day/Night Mode">ðŸŒ™</button>

  <!-- OVERLAY MENU -->
  <div id="menuOverlay">
    <div id="menuPanel">
      <div class="mp-header">
        <div class="mp-title">L4 Controls & Settings</div>
        <button class="mp-close" id="menuCloseBtn" type="button">Close</button>
      </div>
      <div class="mp-body">

        <!-- Rotation -->
        <div class="card">
          <h3>Rotation</h3>
          <div class="row">
            <button id="rollL" class="btn" type="button">Air Roll Left</button>
            <button id="rollR" class="btn active" type="button">Air Roll Right</button>
            <button id="rollFree" class="btn" type="button">Air Roll (Free)</button>
            <button id="ringMode" class="btn" type="button">Ring Mode</button>
            <button id="restart" class="btn" type="button">Restart</button>
            <button id="orbitCW" class="btn" type="button">Orbit CW</button>
            <button id="orbitCCW" class="btn" type="button">Orbit CCW</button>
          </div>

          <div class="row">
            <label>Air Roll Mode:</label>
            <button id="toggleMode" class="btn active" type="button">Toggle</button>
          </div>

          <div class="tip">
            <b>Tip:</b> With Air Roll Right, rotate the stick clockwise. With Air Roll Left, rotate the stick counter-clockwise.
          </div>
        </div>

<!-- Dynamics -->
<div class="card">
  <h3>Dynamics</h3>

  <div class="row">
    <button id="resetPhysicsDefaults" class="btn" type="button">Reset to Defaults</button>
  </div>

  <div class="row sl">
    <label for="accelPitch">Max Pitch Accel (Â°/sÂ²)</label>
    <input id="accelPitch" type="range" min="120" max="1200" step="5" value="714"/>
    <span class="tag" id="accelPitchTag">714</span>
  </div>

  <div class="row sl">
    <label for="accelYaw">Max Yaw Accel (Â°/sÂ²)</label>
    <input id="accelYaw" type="range" min="120" max="1200" step="5" value="521"/>
    <span class="tag" id="accelYawTag">521</span>
  </div>

  <div class="row sl">
    <label for="accelRoll">Max Roll Accel (Â°/sÂ²)</label>
    <input id="accelRoll" type="range" min="120" max="2400" step="5" value="2153"/>
    <span class="tag" id="accelRollTag">2153</span>
  </div>

  <div class="row sl">
    <label for="curveRange">Input Curve</label>
    <input id="curveRange" type="range" min="1.0" max="2.2" step="0.05" value="1.0"/>
    <span class="tag" id="curveTag">1.00</span>
  </div>

  <div class="row sl">
    <label for="dampRange">Damp (No-DAR)</label>
    <input id="dampRange" type="range" min="0.0" max="6.0" step="0.05" value="2.96"/>
    <span class="tag" id="dampTag">2.96</span>
  </div>

  <div class="row sl">
    <label for="dampDARRange">Damp (DAR)</label>
    <input id="dampDARRange" type="range" min="0.0" max="6.0" step="0.05" value="4.35"/>
    <span class="tag" id="dampDARTag">4.35</span>
  </div>

  <div class="row sl">
    <label for="brakeRange">Release Brake</label>
    <input id="brakeRange" type="range" min="0.0" max="6.0" step="0.1" value="0.0"/>
    <span class="tag" id="brakeTag">0.0</span>
  </div>

  <div class="row sl">
    <label for="wmaxRange">Max Ï‰ (global)</label>
    <input id="wmaxRange" type="range" min="4.0" max="24.0" step="0.1" value="5.5"/>
    <span class="tag" id="wmaxTag">5.5</span>
  </div>

  <div class="row sl">
    <label for="wmaxPitch">Max Pitch Ï‰</label>
    <input id="wmaxPitch" type="range" min="4.0" max="24.0" step="0.5" value="24.0"/>
    <span class="tag" id="wmaxPitchTag">24.0</span>
  </div>

  <div class="row sl">
    <label for="wmaxYaw">Max Yaw Ï‰</label>
    <input id="wmaxYaw" type="range" min="4.0" max="24.0" step="0.5" value="24.0"/>
    <span class="tag" id="wmaxYawTag">24.0</span>
  </div>

  <div class="row sl">
    <label for="wmaxRoll">Max Roll Ï‰</label>
    <input id="wmaxRoll" type="range" min="4.0" max="24.0" step="0.5" value="24.0"/>
    <span class="tag" id="wmaxRollTag">24.0</span>
  </div>
</div>
<!-- Car -->
<div class="card">
  <h3>Car</h3>
  <div class="row sl">
    <label for="presetSel">Body</label>
    <select id="presetSel">
      <option value="placeholder">Placeholder (140Ã—56Ã—240)</option>
      <option value="octane" selected>Octane proportions</option>
      <option value="dominus">Dominus proportions</option>
    </select>
  </div>
</div>
        <!-- View / HUD -->
        <div class="card">
          <h3>View & HUD</h3>

          <div class="row">
            <button id="arrowToggle" class="btn active" type="button">Show Arrow</button>
            <button id="circleToggle" class="btn active" type="button">Show Circle</button>
          </div>

          <div class="row sl">
            <label for="zoomSlider">Zoom</label>
            <input id="zoomSlider" type="range" min="0.20" max="4.00" step="0.01" value="1.00" />
            <span class="tag" id="zoomVal">1.00Ã—</span>
          </div>

          <div class="row sl">
            <label for="stickSizeSlider">Stick Size</label>
            <input id="stickSizeSlider" type="range" min="60" max="180" step="1" value="100" />
            <span class="tag" id="stickVal">100</span>
          </div>

          <div class="row sl">
            <label for="arrowSlider">Arrow Size</label>
            <input id="arrowSlider" type="range" min="0.60" max="4.00" step="0.01" value="4.00" />
            <span class="tag" id="arrowVal">4.00Ã—</span>
          </div>

          <div class="row sl">
            <label for="circleScale">Circle Scale</label>
            <input id="circleScale" type="range" min="0.2" max="2.0" step="0.05" value="0.3"/>
            <span class="tag" id="circleScaleTag">0.30Ã—</span>
          </div>

          <div class="row sl">
            <label for="circleTilt">Circle Tilt Angle</label>
            <input id="circleTilt" type="range" min="0" max="45" step="1" value="34"/>
            <span class="tag" id="circleTiltTag">38Â°</span>
          </div>

          <div class="row sl">
            <label for="circleTiltModifier">Circle Tilt Modifier</label>
            <input id="circleTiltModifier" type="range" min="-45" max="45" step="1" value="0"/>
            <span class="tag" id="circleTiltModifierTag">0Â°</span>
          </div>

          <div class="row sl">
            <label for="brightnessSlider">Car Brightness</label>
            <input id="brightnessSlider" type="range" min="0.5" max="3.0" step="0.1" value="1.0" />
            <span class="tag" id="brightnessVal">1.00Ã—</span>
          </div>
        </div>

        <!-- Ring Mode Settings -->
        <div class="card">
          <h3>Ring Mode</h3>

          <div class="row">
            <label for="ringDifficulty">Difficulty</label>
            <select id="ringDifficulty">
              <option value="easy">Easy</option>
              <option value="normal" selected>Normal</option>
              <option value="hard">Hard</option>
            </select>
          </div>

          <div class="row sl">
            <label for="ringCameraSpeed">Camera Transition Speed</label>
            <input id="ringCameraSpeed" type="range" min="0.01" max="0.5" step="0.01" value="0.1" />
            <span class="tag" id="ringCameraSpeedVal">0.10</span>
          </div>

          <div class="tip">
            <b>Ring Mode:</b> Navigate through rings using boost. Lower camera speed = slower, smoother transitions to next ring.
            <br><br>
            <b>Difficulty:</b><br>
            â€¢ Easy: Large rings, slower speed, simple patterns<br>
            â€¢ Normal: Balanced challenge<br>
            â€¢ Hard: Smaller rings, faster speed, complex patterns
          </div>
        </div>

        <!-- Audio Settings -->
        <div class="card">
          <h3>Audio</h3>
          <div class="row">
            <button id="toggleSounds" class="btn active" type="button">Game Sounds</button>
            <span class="tag" id="soundsStatus">Enabled</span>
          </div>
          <div class="row">
            <button id="toggleMusic" class="btn active" type="button">Background Music</button>
            <span class="tag" id="musicStatus">Enabled</span>
          </div>
          <div class="tip">
            <b>Game Sounds:</b> Ring pass/miss sounds and boost rumble<br>
            <b>Background Music:</b> 8-bit style music during Ring Mode
          </div>
        </div>

        <!-- Gamepad -->
        <div class="card">
          <h3>Gamepad</h3>
          <div class="row">
            <button id="gpEnable" class="btn active" type="button">Enable</button>
            <span class="tag" id="gpStatus">Enabled (waiting for gamepad)</span>
          </div>
          <div class="row sl">
            <label for="gpPreset">Preset</label>
            <select id="gpPreset">
              <option value="ps5" selected>PS5 / DualSense</option>
              <option value="xinput">Generic XInput</option>
            </select>
          </div>
          <div class="row">
            <button id="gpRemap" class="btn" type="button">Remap Actionâ€¦</button>
            <select id="gpAction" aria-label="Select action to remap">
              <option value="toggleDAR">Toggle DAR</option>
              <option value="rollLeft">Air Roll Left</option>
              <option value="rollRight">Air Roll Right</option>
              <option value="rollFree">Air Roll (Free)</option>
              <option value="boost">Boost (Ring Mode)</option>
              <option value="pause">Pause (Ring Mode)</option>
              <option value="restart">Restart</option>
              <option value="orbitCW">Orbit Clockwise</option>
              <option value="orbitCCW">Orbit Counter-Clockwise</option>
              <option value="toggleTheme">Toggle Day/Night Mode</option>
              <option value="openMenu">Open/Close Menu</option>
            </select>
            <span class="tag" id="gpBindLabel">â€”</span>
          </div>
          <div class="row">
            <button id="gpResetDefaults" class="btn" type="button">Reset to Defaults</button>
          </div>
          <div class="tip">
            <b>Tip:</b> Left stick moves the on-screen stick. Remap any action, then press a button or push an axis to bind.
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Hints -->
  <div id="joyHint">Hold outside the stick to reposition (UI hidden)</div>
  <div id="darHint">Tap to toggle roll â€¢ Hold to move</div>

<script type="module">
// L4 DAR Prototype - Main Application Entry Point
import { init } from "./js/main.js";
init();
</script>
</body>
</html>
